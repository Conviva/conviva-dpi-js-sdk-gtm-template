___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "conviva_appanalytics_public_id",
  "version": 1,
  "securityGroups": [],
  "categories": [
    "ANALYTICS"
  ],
  "displayName": "Conviva DPI JS SDK",
  "brand": {
    "id": "github.com_Conviva",
    "displayName": "Conviva",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Deploy the Conviva JavaScript DPI SDK (script-based AppAnalytics tracker) via GTM. Supports Initialize (with optional Cohort Replay), Set User ID, Track Page View, Track Custom Event, Track Revenue, Set/Unset Custom Tags, and Track Error. See https://github.com/Conviva/conviva-js-script-appanalytics and https://github.com/Conviva/conviva-js-replay.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "selectItems": [
      {
        "displayValue": "Initialize (init)",
        "value": "init"
      },
      {
        "displayValue": "Set User ID (setUserId)",
        "value": "setUserId"
      },
      {
        "displayValue": "Track Page View (trackPageView)",
        "value": "trackPageView"
      },
      {
        "displayValue": "Track Custom Event (trackCustomEvent)",
        "value": "trackCustomEvent"
      },
      {
        "displayValue": "Set Custom Tags (setCustomTags)",
        "value": "setCustomTags"
      },
      {
        "displayValue": "Unset Custom Tags (unsetCustomTags)",
        "value": "unsetCustomTags"
      },
      {
        "displayValue": "Track Error (trackError)",
        "value": "trackError"
      },
      {
        "displayValue": "Track Revenue (trackRevenue)",
        "value": "trackRevenue"
      }
    ],
    "displayName": "Tag Type",
    "defaultValue": "init",
    "simpleValueType": true,
    "name": "type",
    "type": "SELECT",
    "alwaysInSummary": true
  },
  {
    "type": "LABEL",
    "name": "initDescription",
    "displayName": "Initialize – Loads the Conviva SDK and initializes with Customer Key, App ID, and App Version. Fire once per page (e.g. All Pages or Consent Initialization). <a href=\"https://github.com/Conviva/conviva-js-script-appanalytics\">SDK docs</a>",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "init",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "LABEL",
    "name": "setUserIdDescription",
    "displayName": "Set User ID – Sets the viewer/user ID. Trigger after user is identified (e.g. login).",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "setUserId",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "LABEL",
    "name": "trackPageViewDescription",
    "displayName": "Track Page View – Sends a page view. Required for correct metrics. Use DOM Ready / Window Loaded (MPA) or History Change (SPA).",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "trackPageView",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "LABEL",
    "name": "trackCustomEventDescription",
    "displayName": "Track Custom Event – Sends a custom event with name and optional data.",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "trackCustomEvent",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "LABEL",
    "name": "setCustomTagsDescription",
    "displayName": "Set Custom Tags – Key/value pairs applied to all subsequent events.",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "setCustomTags",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "LABEL",
    "name": "unsetCustomTagsDescription",
    "displayName": "Unset Custom Tags – Removes previously set tag keys (comma-separated or one per line).",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "unsetCustomTags",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "LABEL",
    "name": "trackErrorDescription",
    "displayName": "Track Error – Reports an error (message, optional filename, optional error object variable).",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "trackError",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "LABEL",
    "name": "trackRevenueDescription",
    "displayName": "Track Revenue – Sends a revenue/purchase event (conviva_revenue_event) with order amount and transaction ID required; optional currency, tax, shipping, discount, cart size, line items, and extra metadata. Uses same API as Custom Event.",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "trackRevenue",
        "type": "EQUALS"
      }
    ]
  },
  {
    "help": "Find your Customer Key in <a href=\"https://pulse.conviva.com/app/profile/applications\">Pulse → My Profile → Applications</a>.",
    "alwaysInSummary": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "displayName": "Conviva Customer Key*",
    "simpleValueType": true,
    "name": "convivaCustomerKey",
    "type": "TEXT",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "init",
        "type": "EQUALS"
      }
    ]
  },
  {
    "help": "Application name, e.g. \"WEB App\", \"LGTV Web App\".",
    "alwaysInSummary": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "displayName": "App ID*",
    "simpleValueType": true,
    "name": "appId",
    "type": "TEXT",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "init",
        "type": "EQUALS"
      }
    ]
  },
  {
    "displayName": "App Version",
    "simpleValueType": true,
    "name": "appVersion",
    "type": "TEXT",
    "valueHint": "e.g. 1.1.0",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "init",
        "type": "EQUALS"
      }
    ]
  },
  {
    "selectItems": [
      {
        "displayValue": "Conviva-hosted (recommended)",
        "value": "conviva_hosted"
      },
      {
        "displayValue": "Customer-hosted",
        "value": "customer_hosted"
      }
    ],
    "displayName": "Script source",
    "defaultValue": "conviva_hosted",
    "simpleValueType": true,
    "name": "scriptSource",
    "type": "SELECT",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "init",
        "type": "EQUALS"
      }
    ],
    subParams:[
      {
        "selectItems": [
          {
            "displayValue": "v1.5.5",
            "value": "v1.5.5"
          }
        ],
        "displayName": "Script version",
        "defaultValue": "v1.5.5",
        "simpleValueType": true,
        "name": "scriptVersion",
        "type": "SELECT",
        "help": "SDK version to load from Conviva CDN (jsDelivr). Overridden by Custom version when set.",
        "enablingConditions": [
          {
            "paramName": "scriptSource",
            "paramValue": "conviva_hosted",
            "type": "EQUALS"
          }
        ]
      },
      {
        "displayName": "Custom version (optional)",
        "simpleValueType": true,
        "name": "scriptVersionCustom",
        "type": "TEXT",
        "valueHint": "Overrides dropdown when set (e.g. 1.5.5, GTM-init)",
        "enablingConditions": [
          {
            "paramName": "scriptSource",
            "paramValue": "conviva_hosted",
            "type": "EQUALS"
          }
        ]
      },
      {
        "help": "Full URL to convivaAppTracker.js (required when Script source is Customer-hosted).",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "displayName": "Script URL",
        "simpleValueType": true,
        "name": "scriptUrl",
        "type": "TEXT",
        "enablingConditions": [
          {
            "paramName": "scriptSource",
            "paramValue": "customer_hosted",
            "type": "EQUALS"
          }
        ]
      },
    ]
  },
  {
    "defaultValue": false,
    "simpleValueType": true,
    "name": "initWithCohortReplay",
    "checkboxText": "Init with Cohort Replay",
    "type": "CHECKBOX",
    "help": "When enabled, loads and initialises Conviva Session Replay (conviva-js-replay) before the main SDK. Uses the same Customer Key. Replay must run before AppAnalytics. See https://github.com/Conviva/conviva-js-replay.",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "init",
        "type": "EQUALS"
      }
    ]
  },
  {
    "selectItems": [
      { "displayValue": "Conviva-hosted (recommended)", "value": "conviva_hosted" },
      { "displayValue": "Customer-hosted", "value": "customer_hosted" }
    ],
    "displayName": "Replay script source",
    "defaultValue": "conviva_hosted",
    "simpleValueType": true,
    "name": "replayScriptSource",
    "type": "SELECT",
    "help": "Load Cohort Replay SDK from Conviva CDN or your own URL.",
    "enablingConditions": [
      { "paramName": "type", "paramValue": "init", "type": "EQUALS" },
      { "paramName": "initWithCohortReplay", "paramValue": true, "type": "EQUALS" }
    ],
    "subParams": [
      {
        "selectItems": [
          { "displayValue": "v1.0.1", "value": "v1.0.1" }
        ],
        "displayName": "Replay script version",
        "defaultValue": "v1.0.1",
        "simpleValueType": true,
        "name": "replayScriptVersion",
        "type": "SELECT",
        "help": "Replay SDK version from Conviva CDN. Overridden by Custom version when set.",
        "enablingConditions": [
          { "paramName": "replayScriptSource", "paramValue": "conviva_hosted", "type": "EQUALS" }
        ]
      },
      {
        "displayName": "Replay custom version (optional)",
        "simpleValueType": true,
        "name": "replayScriptVersionCustom",
        "type": "TEXT",
        "valueHint": "Overrides dropdown when set (e.g. 1.0.1, main)",
        "enablingConditions": [
          { "paramName": "replayScriptSource", "paramValue": "conviva_hosted", "type": "EQUALS" }
        ]
      },
      {
        "help": "Full URL to conviva-replay.umd.min.js (or your replay bundle). Required when Replay script source is Customer-hosted.",
        "valueValidators": [
          { "type": "NON_EMPTY" }
        ],
        "displayName": "Replay script URL",
        "simpleValueType": true,
        "name": "replayScriptUrl",
        "type": "TEXT",
        "enablingConditions": [
          { "paramName": "replayScriptSource", "paramValue": "customer_hosted", "type": "EQUALS" }
        ]
      }
    ]
  },
  {
    "displayName": "User ID (optional)",
    "simpleValueType": true,
    "name": "initUserId",
    "type": "TEXT",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "init",
        "type": "EQUALS"
      }
    ]
  },
  {
    "displayName": "Client ID (optional – set before init)",
    "simpleValueType": true,
    "name": "initClientId",
    "type": "TEXT",
    "help": "Sync clientId from another instance (e.g. mobile app, subdomain). Call setClientId before convivaAppTracker. Leave empty to let the SDK generate one.",
    "valueHint": "e.g. from getClientId in another context",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "init",
        "type": "EQUALS"
      }
    ]
  },
  {
    "displayName": "Default Custom Tags",
    "name": "initCustomTags",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "Key",
        "name": "key",
        "type": "TEXT"
      },
      {
        "defaultValue": "",
        "displayName": "Value",
        "name": "value",
        "type": "TEXT"
      }
    ],
    "type": "SIMPLE_TABLE",
    "newRowButtonText": "Add Tag",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "init",
        "type": "EQUALS"
      }
    ]
  },
  {
    "defaultValue": false,
    "simpleValueType": true,
    "name": "enableClIdInCookies",
    "checkboxText": "Enable Client ID in cookies (share clientId across subdomains)",
    "type": "CHECKBOX",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "init",
        "type": "EQUALS"
      }
    ]
  },
  {
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "init",
        "type": "EQUALS"
      }
    ],
    "displayName": "Device Metadata (optional)",
    "name": "deviceMetadataGroup",
    "groupStyle": "ZIPPY_CLOSED",
    "type": "GROUP",
    "subParams": [
      {
        "displayName": "Device Brand",
        "simpleValueType": true,
        "name": "deviceBrand",
        "type": "TEXT",
        "valueHint": "e.g. Apple, Samsung SmartTV"
      },
      {
        "displayName": "Device Manufacturer",
        "simpleValueType": true,
        "name": "deviceManufacturer",
        "type": "TEXT",
        "valueHint": "e.g. Samsung, Apple"
      },
      {
        "displayName": "Device Model",
        "simpleValueType": true,
        "name": "deviceModel",
        "type": "TEXT",
        "valueHint": "e.g. iPhone 6 Plus, MacBookPro"
      },
      {
        "displayName": "Device Type",
        "simpleValueType": true,
        "name": "deviceType",
        "type": "SELECT",
        "defaultValue": "",
        "selectItems": [
          { "displayValue": "", "value": "" },
          { "displayValue": "Desktop", "value": "DESKTOP" },
          { "displayValue": "Games Console", "value": "Console" },
          { "displayValue": "Set Top Box", "value": "Settop" },
          { "displayValue": "Mobile", "value": "Mobile" },
          { "displayValue": "Tablet", "value": "Tablet" },
          { "displayValue": "Smart TV", "value": "SmartTV" },
          { "displayValue": "Vehicle", "value": "Vehicle" },
          { "displayValue": "Other", "value": "Other" }
        ]
      },
      {
        "displayName": "Device Version",
        "simpleValueType": true,
        "name": "deviceVersion",
        "type": "TEXT",
        "valueHint": "e.g. NAForMac"
      },
      {
        "displayName": "Operating System Name",
        "simpleValueType": true,
        "name": "deviceOsName",
        "type": "TEXT",
        "valueHint": "e.g. MAC, WINDOWS, LINUX, IOS, ANDROID"
      },
      {
        "displayName": "Operating System Version",
        "simpleValueType": true,
        "name": "deviceOsVersion",
        "type": "TEXT",
        "valueHint": "e.g. 10.13.6, 8.1"
      },
      {
        "displayName": "Device Category",
        "simpleValueType": true,
        "name": "deviceCategory",
        "type": "SELECT",
        "defaultValue": "",
        "selectItems": [
          { "displayValue": "", "value": "" },
          { "displayValue": "Android Device (AND)", "value": "AND" },
          { "displayValue": "Apple Device (APL)", "value": "APL" },
          { "displayValue": "Chromecast (CHR)", "value": "CHR" },
          { "displayValue": "Desktop App (DSKAPP)", "value": "DSKAPP" },
          { "displayValue": "Device Simulator (SIMULATOR)", "value": "SIMULATOR" },
          { "displayValue": "LG TV (LGTV)", "value": "LGTV" },
          { "displayValue": "Nintendo (NINTENDO)", "value": "NINTENDO" },
          { "displayValue": "PlayStation (PS)", "value": "PS" },
          { "displayValue": "Roku (RK)", "value": "RK" },
          { "displayValue": "Samsung TV (SAMSUNGTV)", "value": "SAMSUNGTV" },
          { "displayValue": "Smart TV (TV)", "value": "TV" },
          { "displayValue": "Set Top Box (STB)", "value": "STB" },
          { "displayValue": "TiVo (TIVO)", "value": "TIVO" },
          { "displayValue": "Web (WEB)", "value": "WEB" },
          { "displayValue": "Windows Device (WIN)", "value": "WIN" },
          { "displayValue": "Xbox (XB)", "value": "XB" },
          { "displayValue": "KaiOS Device (KAIOS)", "value": "KAIOS" },
          { "displayValue": "Linux (LNX)", "value": "LNX" }
        ]
      },
      {
        "displayName": "Framework Name",
        "simpleValueType": true,
        "name": "deviceFrameworkName",
        "type": "TEXT",
        "valueHint": "e.g. Web"
      },
      {
        "displayName": "Framework Version",
        "simpleValueType": true,
        "name": "deviceFrameworkVersion",
        "type": "TEXT",
        "valueHint": "e.g. 1.0.0"
      }
    ]
  },
  {
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "displayName": "User ID*",
    "simpleValueType": true,
    "name": "setUserId",
    "type": "TEXT",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "setUserId",
        "type": "EQUALS"
      }
    ]
  },
  {
    "displayName": "Page Title Override",
    "simpleValueType": true,
    "name": "trackPageViewTitle",
    "type": "TEXT",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "trackPageView",
        "type": "EQUALS"
      }
    ]
  },
  {
    "defaultValue": true,
    "simpleValueType": true,
    "name": "trackPageViewOnlyIfInitialized",
    "checkboxText": "Only fire if initialized",
    "type": "CHECKBOX",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "trackPageView",
        "type": "EQUALS"
      }
    ]
  },
  {
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "displayName": "Event Name*",
    "simpleValueType": true,
    "name": "eventName",
    "type": "TEXT",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "trackCustomEvent",
        "type": "EQUALS"
      }
    ]
  },
  {
    "displayName": "Event Data",
    "name": "eventData",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "Name",
        "name": "name",
        "type": "TEXT"
      },
      {
        "defaultValue": "",
        "displayName": "Value",
        "name": "value",
        "type": "TEXT"
      }
    ],
    "type": "SIMPLE_TABLE",
    "newRowButtonText": "Add Property",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "trackCustomEvent",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "SELECT",
    "name": "eventDataObject",
    "displayName": "Event Data Object (variable)",
    "macrosInSelect": true,
    "selectItems": [],
    "simpleValueType": true,
    "help": "Optional: select a GTM variable that returns an object. Merged with table above if both set.",
    "notSetText": "Don't set",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "trackCustomEvent",
        "type": "EQUALS"
      }
    ]
  },
  {
    "defaultValue": true,
    "simpleValueType": true,
    "name": "trackCustomEventOnlyIfInitialized",
    "checkboxText": "Only fire if initialized",
    "type": "CHECKBOX",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "trackCustomEvent",
        "type": "EQUALS"
      }
    ]
  },
  {
    "help": "Total order amount (required for revenue metrics).",
    "valueValidators": [{ "type": "NON_EMPTY" }],
    "displayName": "Total order amount*",
    "simpleValueType": true,
    "name": "revenueTotalOrderAmount",
    "type": "TEXT",
    "valueHint": "e.g. 99.99",
    "enablingConditions": [
      { "paramName": "type", "paramValue": "trackRevenue", "type": "EQUALS" }
    ]
  },
  {
    "help": "Order ID / transaction ID (required).",
    "valueValidators": [{ "type": "NON_EMPTY" }],
    "displayName": "Order ID (transaction ID)*",
    "simpleValueType": true,
    "name": "revenueOrderId",
    "type": "TEXT",
    "valueHint": "e.g. ord_12345",
    "enablingConditions": [
      { "paramName": "type", "paramValue": "trackRevenue", "type": "EQUALS" }
    ]
  },
  {
    "displayName": "Currency",
    "simpleValueType": true,
    "name": "revenueCurrency",
    "type": "TEXT",
    "valueHint": "e.g. USD",
    "enablingConditions": [
      { "paramName": "type", "paramValue": "trackRevenue", "type": "EQUALS" }
    ]
  },
  {
    "displayName": "Tax amount",
    "simpleValueType": true,
    "name": "revenueTaxAmount",
    "type": "TEXT",
    "enablingConditions": [
      { "paramName": "type", "paramValue": "trackRevenue", "type": "EQUALS" }
    ]
  },
  {
    "displayName": "Shipping cost",
    "simpleValueType": true,
    "name": "revenueShippingCost",
    "type": "TEXT",
    "enablingConditions": [
      { "paramName": "type", "paramValue": "trackRevenue", "type": "EQUALS" }
    ]
  },
  {
    "displayName": "Discount / coupon value",
    "simpleValueType": true,
    "name": "revenueDiscount",
    "type": "TEXT",
    "enablingConditions": [
      { "paramName": "type", "paramValue": "trackRevenue", "type": "EQUALS" }
    ]
  },
  {
    "displayName": "Cart size (number of items)",
    "simpleValueType": true,
    "name": "revenueCartSize",
    "type": "TEXT",
    "valueHint": "e.g. 3",
    "enablingConditions": [
      { "paramName": "type", "paramValue": "trackRevenue", "type": "EQUALS" }
    ]
  },
  {
    "type": "SELECT",
    "name": "revenueItemsList",
    "displayName": "Purchased items (variable)",
    "macrosInSelect": true,
    "selectItems": [],
    "simpleValueType": true,
    "notSetText": "Don't set",
    "help": "GTM variable that returns an array of line-item objects. Passed through as-is to the event. Recommended keys per item (for backend): productId, name, sku, category, unitPrice, quantity, discount, brand, variant; other keys are sent as-is and can be mapped in the backend.",
    "enablingConditions": [
      { "paramName": "type", "paramValue": "trackRevenue", "type": "EQUALS" }
    ]
  },
  {
    "displayName": "Payment method",
    "simpleValueType": true,
    "name": "revenuePaymentMethod",
    "type": "TEXT",
    "valueHint": "e.g. card, ApplePay, PayPal",
    "enablingConditions": [
      { "paramName": "type", "paramValue": "trackRevenue", "type": "EQUALS" }
    ]
  },
  {
    "displayName": "Payment provider",
    "simpleValueType": true,
    "name": "revenuePaymentProvider",
    "type": "TEXT",
    "valueHint": "e.g. Stripe, Adyen",
    "enablingConditions": [
      { "paramName": "type", "paramValue": "trackRevenue", "type": "EQUALS" }
    ]
  },
  {
    "displayName": "Order status",
    "simpleValueType": true,
    "name": "revenueOrderStatus",
    "type": "TEXT",
    "enablingConditions": [
      { "paramName": "type", "paramValue": "trackRevenue", "type": "EQUALS" }
    ]
  },
  {
    "displayName": "Additional metadata",
    "name": "revenueExtraMetadata",
    "simpleTableColumns": [
      { "defaultValue": "", "displayName": "Key", "name": "key", "type": "TEXT" },
      { "defaultValue": "", "displayName": "Value", "name": "value", "type": "TEXT" }
    ],
    "type": "SIMPLE_TABLE",
    "newRowButtonText": "Add row",
    "help": "Extra key/value pairs to include in the revenue event payload.",
    "enablingConditions": [
      { "paramName": "type", "paramValue": "trackRevenue", "type": "EQUALS" }
    ]
  },
  {
    "type": "SELECT",
    "name": "revenueDataObject",
    "displayName": "Revenue data object (variable)",
    "macrosInSelect": true,
    "selectItems": [],
    "simpleValueType": true,
    "help": "Optional: GTM variable returning an object. Merged with the fields above.",
    "notSetText": "Don't set",
    "enablingConditions": [
      { "paramName": "type", "paramValue": "trackRevenue", "type": "EQUALS" }
    ]
  },
  {
    "defaultValue": true,
    "simpleValueType": true,
    "name": "trackRevenueOnlyIfInitialized",
    "checkboxText": "Only fire if initialized",
    "type": "CHECKBOX",
    "enablingConditions": [
      { "paramName": "type", "paramValue": "trackRevenue", "type": "EQUALS" }
    ]
  },
  {
    "displayName": "Custom Tags",
    "name": "setCustomTagsTable",
    "simpleTableColumns": [
      {
        "defaultValue": "",
        "displayName": "Key",
        "name": "key",
        "type": "TEXT"
      },
      {
        "defaultValue": "",
        "displayName": "Value",
        "name": "value",
        "type": "TEXT"
      }
    ],
    "type": "SIMPLE_TABLE",
    "newRowButtonText": "Add Tag",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "setCustomTags",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "SELECT",
    "name": "setCustomTagsObject",
    "displayName": "Custom Tags (variable)",
    "macrosInSelect": true,
    "selectItems": [],
    "simpleValueType": true,
    "help": "Optional: select a GTM variable that returns an object (e.g. {{Conviva – Custom Tags}}). Merged with the table above if both set.",
    "notSetText": "Don't set",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "setCustomTags",
        "type": "EQUALS"
      }
    ]
  },
  {
    "help": "Comma-separated list of tag keys to unset, e.g. tagKey1, tagKey2",
    "displayName": "Tag Keys to Unset",
    "simpleValueType": true,
    "name": "unsetCustomTagsKeys",
    "type": "TEXT",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "unsetCustomTags",
        "type": "EQUALS"
      }
    ]
  },
  {
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "displayName": "Error Message*",
    "simpleValueType": true,
    "name": "trackErrorMessage",
    "type": "TEXT",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "trackError",
        "type": "EQUALS"
      }
    ]
  },
  {
    "displayName": "Filename (optional)",
    "simpleValueType": true,
    "name": "trackErrorFilename",
    "type": "TEXT",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "trackError",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "SELECT",
    "name": "trackErrorObject",
    "displayName": "Error object (variable)",
    "macrosInSelect": true,
    "selectItems": [],
    "simpleValueType": true,
    "notSetText": "Don't set",
    "enablingConditions": [
      {
        "paramName": "type",
        "paramValue": "trackError",
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___
// APIs
const copyFromWindow = require('copyFromWindow');
const getType = require('getType');
const injectScript = require('injectScript');
const createQueue = require('createQueue');
const setInWindow = require('setInWindow');
const callInWindow = require('callInWindow');
const log = require('logToConsole');
const makeString = require('makeString');
const makeTableMap = require('makeTableMap');
const JSON = require('JSON');
const Object = require('Object');

// Constants – Conviva script creates window.apptracker; Conviva-hosted URL built from version (jsDelivr CDN)
const CONVIVA_SCRIPT_BASE = 'https://sensor.conviva.com/dpi/releases/';
const CONVIVA_SCRIPT_FILE = '/convivaAppTracker.js';
const DEFAULT_VERSION = 'v1.5.5';
const TRACKER_NAMESPACE = 'apptracker';
const LOG_PREFIX = '[Conviva AppAnalytics / GTM] ';
// Cohort Replay – must load and init before main SDK (same jsDelivr pattern)
const REPLAY_SCRIPT_BASE = 'https://sensor.conviva.com/replay/releases/';
const REPLAY_SCRIPT_FILE = '/conviva-replay.umd.min.js';
const REPLAY_DEFAULT_VERSION = 'v1.0.1';
const REPLAY_NAMESPACE = 'ConvivaReplay';

// Ensures apptracker queue stub and GlobalConvivaNamespace exist (sandbox: use createQueue/createArgumentsQueue only).
const enablePreLoad = function() {

  const apptracker = copyFromWindow('apptracker');
  if (apptracker) {
    return apptracker;
  }
  const globalNamespace = createQueue('GlobalConvivaNamespace');
  globalNamespace('apptracker');

  setInWindow('apptracker', function() {
    callInWindow('apptracker.q.push', arguments);
  });
  createQueue('apptracker.q');
  return copyFromWindow('apptracker');
};
const apptracker = enablePreLoad();
const fail = function(msg) {
  log(LOG_PREFIX + 'Error: ' + msg);
  return data.gtmOnFailure();
};

const isObject = function(input) {
  return input !== null && getType(input) === 'object';
};

// Parse comma-separated keys into array of trimmed strings
const stringToArrayAndTrim = function(str) {
  if (!str || typeof str !== 'string') return [];
  return str.split(',').map(function(s) { return s.trim(); }).filter(function(s) { return s !== ''; });
};

const onScriptFailure = function() {
  return fail('Failed to load Conviva AppAnalytics script');
};

const onReplayFailure = function() {
  return fail('Failed to load Conviva Replay script');
};

const runNonInit = function() {
  if (!apptracker || typeof apptracker !== 'function') {
    return fail('Conviva apptracker not found. Ensure the Initialize tag has run.');
  }

  switch (data.type) {
    case 'setUserId':
      apptracker('setUserId', data.setUserId);
      break;
    case 'trackPageView':
      if (data.trackPageViewTitle) {
        apptracker('trackPageView', { title: data.trackPageViewTitle });
      } else {
        apptracker('trackPageView');
      }
      break;
    case 'trackCustomEvent': {
      const tableData = makeTableMap(data.eventData || [], 'name', 'value');
      let eventDataObj = tableData && isObject(tableData) ? tableData : {};
      if (data.eventDataObject && isObject(data.eventDataObject)) {
        const obj = data.eventDataObject;
        for (var k in obj) { if (obj.hasOwnProperty(k)) eventDataObj[k] = obj[k]; }
      }
      apptracker('trackCustomEvent', { name: data.eventName, data: eventDataObj });
      break;
    }
    case 'trackRevenue': {
      const revenueData = {};
      revenueData.transactionId = data.revenueOrderId;
      revenueData.totalOrderAmount = data.revenueTotalOrderAmount;
      if (data.revenueCurrency) revenueData.currency = data.revenueCurrency;
      if (data.revenueTaxAmount) revenueData.taxAmount = data.revenueTaxAmount;
      if (data.revenueShippingCost) revenueData.shippingCost = data.revenueShippingCost;
      if (data.revenueDiscount) revenueData.discount = data.revenueDiscount;
      if (data.revenueCartSize) revenueData.cartSize = data.revenueCartSize;
      if (data.revenuePaymentMethod) revenueData.paymentMethod = data.revenuePaymentMethod;
      if (data.revenuePaymentProvider) revenueData.paymentProvider = data.revenuePaymentProvider;
      if (data.revenueOrderStatus) revenueData.orderStatus = data.revenueOrderStatus;
      if (data.revenueItemsList && getType(data.revenueItemsList) === 'array' && data.revenueItemsList.length > 0) {
        revenueData.items = data.revenueItemsList;
      }
      var extraMeta = makeTableMap(data.revenueExtraMetadata || [], 'key', 'value');
      if (extraMeta && isObject(extraMeta) && Object.keys(extraMeta).length > 0) {
        for (var ek in extraMeta) { if (extraMeta.hasOwnProperty(ek)) revenueData[ek] = extraMeta[ek]; }
      }
      if (data.revenueDataObject && isObject(data.revenueDataObject)) {
        var robj = data.revenueDataObject;
        for (var rk in robj) { if (robj.hasOwnProperty(rk)) revenueData[rk] = robj[rk]; }
      }
      apptracker('trackCustomEvent', { name: 'conviva_revenue_event', data: revenueData });
      break;
    }
    case 'setCustomTags': {
      var tags = makeTableMap(data.setCustomTagsTable || [], 'key', 'value') || {};
      if (!isObject(tags)) tags = {};
      if (data.setCustomTagsObject && isObject(data.setCustomTagsObject)) {
        var cobj = data.setCustomTagsObject;
        for (var ck in cobj) { if (cobj.hasOwnProperty(ck)) tags[ck] = cobj[ck]; }
      }
      if (Object.keys(tags).length > 0) apptracker('setCustomTags', tags);
      break;
    }
    case 'unsetCustomTags': {
      const keys = stringToArrayAndTrim(data.unsetCustomTagsKeys || '');
      if (keys.length > 0) apptracker('unsetCustomTags', keys);
      break;
    }
    case 'trackError': {
      const errPayload = { message: data.trackErrorMessage };
      if (data.trackErrorFilename) errPayload.filename = data.trackErrorFilename;
      if (data.trackErrorObject != null) errPayload.error = data.trackErrorObject;
      apptracker('trackError', errPayload);
      break;
    }
    default:
      return fail('Unknown tag type: ' + data.type);
  }
  data.gtmOnSuccess();
};

// Build init config: appId, convivaCustomerKey, appVersion, optional enableClIdInCookies, optional deviceMetadata
const buildInitConfig = function() {
  const config = {
    appId: data.appId,
    convivaCustomerKey: data.convivaCustomerKey,
    appVersion: data.appVersion || undefined
  };
  if (data.enableClIdInCookies === true) {
    config.enableClIdInCookies = true;
  }
  const deviceMetadata = {};
  if (data.deviceBrand) deviceMetadata.DeviceBrand = data.deviceBrand;
  if (data.deviceManufacturer) deviceMetadata.DeviceManufacturer = data.deviceManufacturer;
  if (data.deviceModel) deviceMetadata.DeviceModel = data.deviceModel;
  if (data.deviceType) deviceMetadata.DeviceType = data.deviceType;
  if (data.deviceVersion) deviceMetadata.DeviceVersion = data.deviceVersion;
  if (data.deviceOsName) deviceMetadata.OperatingSystemName = data.deviceOsName;
  if (data.deviceOsVersion) deviceMetadata.OperatingSystemVersion = data.deviceOsVersion;
  if (data.deviceCategory) deviceMetadata.DeviceCategory = data.deviceCategory;
  if (data.deviceFrameworkName) deviceMetadata.FrameworkName = data.deviceFrameworkName;
  if (data.deviceFrameworkVersion) deviceMetadata.FrameworkVersion = data.deviceFrameworkVersion;
  if (Object.keys(deviceMetadata).length > 0) config.deviceMetadata = deviceMetadata;
  return config;
};

const onScriptSuccess = function() {
  if (!apptracker || typeof apptracker !== 'function') return fail('Conviva apptracker not loaded');

  var initClientIdStr = data.initClientId ? makeString(data.initClientId).trim() : '';
  if (initClientIdStr !== '') {
    apptracker('setClientId', initClientIdStr);
  }
  // Init: call convivaAppTracker with config, then optional setUserId and setCustomTags
  apptracker('convivaAppTracker', buildInitConfig());

  if (data.initUserId) apptracker('setUserId', data.initUserId);
  const initTags = makeTableMap(data.initCustomTags || [], 'key', 'value');
  if (initTags && isObject(initTags) && Object.keys(initTags).length > 0) apptracker('setCustomTags', initTags);

  data.gtmOnSuccess();
};

if (data.type === 'init') {
  var scriptUrl;
  if (data.scriptSource === 'customer_hosted') {
    scriptUrl = data.scriptUrl;
    if (!scriptUrl) return fail('Script URL is required for Customer-hosted source');
  } else {
    var version = (data.scriptVersionCustom && data.scriptVersionCustom.trim() !== '') ? data.scriptVersionCustom.trim() : (data.scriptVersion || DEFAULT_VERSION);
    scriptUrl = CONVIVA_SCRIPT_BASE + version + CONVIVA_SCRIPT_FILE;
  }
  if (data.initWithCohortReplay === true) {
    var replayUrl;
    if (data.replayScriptSource === 'customer_hosted') {
      replayUrl = data.replayScriptUrl;
      if (!replayUrl) return fail('Replay script URL is required for Customer-hosted Replay source');
    } else {
      var replayVersion = (data.replayScriptVersionCustom && data.replayScriptVersionCustom.trim() !== '') ? data.replayScriptVersionCustom.trim() : (data.replayScriptVersion || REPLAY_DEFAULT_VERSION);
      replayUrl = REPLAY_SCRIPT_BASE + replayVersion + REPLAY_SCRIPT_FILE;
    }
    var onReplaySuccess = function() {
      var ConvivaReplay = copyFromWindow(REPLAY_NAMESPACE);
      if (ConvivaReplay && typeof ConvivaReplay.init === 'function') {
        ConvivaReplay.init(data.convivaCustomerKey);
      }
      injectScript(scriptUrl, onScriptSuccess, onScriptFailure, 'conviva_appanalytics');
    };
    injectScript(replayUrl, onReplaySuccess, onReplayFailure, 'conviva_replay');
  } else {
    injectScript(scriptUrl, onScriptSuccess, onScriptFailure, 'conviva_appanalytics');
  }
} else {
  runNonInit();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "apptracker"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  { "type": 1, "string": "key" },
                  { "type": 1, "string": "read" },
                  { "type": 1, "string": "write" },
                  { "type": 1, "string": "execute" }
                ],
                "mapValue": [
                  { "type": 1, "string": "GlobalConvivaNamespace" },
                  { "type": 8, "boolean": true },
                  { "type": 8, "boolean": true },
                  { "type": 8, "boolean": true }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  { "type": 1, "string": "key" },
                  { "type": 1, "string": "read" },
                  { "type": 1, "string": "execute" },
                  { "type": 1, "string": "write" }
                ],
                "mapValue": [
                  { "type": 1, "string": "ConvivaReplay" },
                  { "type": 8, "boolean": true },
                  { "type": 8, "boolean": true },
                  { "type": 8, "boolean": false }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "apptracker.q"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "apptracker.q.push"
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://sensor.conviva.com/dpi/releases/*"
              },
              {
                "type": 1,
                "string": "https://sensor.conviva.com/replay/releases/*"
              },
              {
                "type": 1,
                "string": "https://*.conviva.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

setup: "const mockData = {};"
scenarios:
- name: Init tag loads script and calls convivaAppTracker
  code: |-
    mockData.type = 'init';
    mockData.convivaCustomerKey = 'test_customer_key';
    mockData.appId = 'WEB App';
    mockData.appVersion = '1.0.0';
    mockData.scriptSource = 'conviva_hosted';

    var injectUrl;
    var onSuccess;
    mock('injectScript', function(url, success, failure) {
      injectUrl = url;
      onSuccess = success;
      success();
    });
    mock('copyFromWindow', function(key) {
      return function(cmd, arg) {
        if (cmd === 'convivaAppTracker') {
          assertThat(arg.appId).isEqualTo('WEB App');
          assertThat(arg.convivaCustomerKey).isEqualTo('test_customer_key');
          assertThat(arg.appVersion).isEqualTo('1.0.0');
        }
      };
    });

    runCode(mockData);
    assertApi('gtmOnSuccess').wasCalled();
- name: setUserId tag calls apptracker with setUserId
  code: |-
    mockData.type = 'setUserId';
    mockData.setUserId = 'user_123';
    mock('copyFromWindow', function(key) {
      return function(cmd, val) {
        assertThat(cmd).isEqualTo('setUserId');
        assertThat(val).isEqualTo('user_123');
      };
    });
    runCode(mockData);
    assertApi('gtmOnSuccess').wasCalled();
- name: trackPageView tag calls apptracker with no arg
  code: |-
    mockData.type = 'trackPageView';
    mockData.trackPageViewTitle = '';
    mock('copyFromWindow', function(key) {
      return function(cmd, arg) {
        assertThat(cmd).isEqualTo('trackPageView');
        assertThat(arg).isEqualTo(undefined);
      };
    });
    runCode(mockData);
    assertApi('gtmOnSuccess').wasCalled();
- name: trackPageView with title override
  code: |-
    mockData.type = 'trackPageView';
    mockData.trackPageViewTitle = 'My Page';
    mock('copyFromWindow', function(key) {
      return function(cmd, arg) {
        assertThat(cmd).isEqualTo('trackPageView');
        assertThat(arg).isEqualTo({ title: 'My Page' });
      };
    });
    runCode(mockData);
    assertApi('gtmOnSuccess').wasCalled();
- name: trackCustomEvent tag calls apptracker with name and data
  code: |-
    mockData.type = 'trackCustomEvent';
    mockData.eventName = 'test_event';
    mockData.eventData = [{ name: 'k', value: 'v' }];
    mock('copyFromWindow', function(key) {
      return function(cmd, arg) {
        assertThat(cmd).isEqualTo('trackCustomEvent');
        assertThat(arg.name).isEqualTo('test_event');
        assertThat(arg.data).isEqualTo({ k: 'v' });
      };
    });
    runCode(mockData);
    assertApi('gtmOnSuccess').wasCalled();
- name: trackRevenue tag calls apptracker with conviva_revenue_event
  code: |-
    mockData.type = 'trackRevenue';
    mockData.revenueOrderId = 'ord_123';
    mockData.revenueTotalOrderAmount = '99.99';
    mockData.revenueCurrency = 'USD';
    mock('copyFromWindow', function(key) {
      return function(cmd, arg) {
        assertThat(cmd).isEqualTo('trackCustomEvent');
        assertThat(arg.name).isEqualTo('conviva_revenue_event');
        assertThat(arg.data.transactionId).isEqualTo('ord_123');
        assertThat(arg.data.totalOrderAmount).isEqualTo('99.99');
        assertThat(arg.data.currency).isEqualTo('USD');
      };
    });
    runCode(mockData);
    assertApi('gtmOnSuccess').wasCalled();
- name: setCustomTags tag calls apptracker with tags object
  code: |-
    mockData.type = 'setCustomTags';
    mockData.setCustomTagsTable = [{ key: 'a', value: '1' }];
    mock('copyFromWindow', function(key) {
      return function(cmd, arg) {
        assertThat(cmd).isEqualTo('setCustomTags');
        assertThat(arg).isEqualTo({ a: '1' });
      };
    });
    runCode(mockData);
    assertApi('gtmOnSuccess').wasCalled();
- name: unsetCustomTags tag calls apptracker with array of keys
  code: |-
    mockData.type = 'unsetCustomTags';
    mockData.unsetCustomTagsKeys = 'key1, key2';
    mock('copyFromWindow', function(key) {
      return function(cmd, arg) {
        assertThat(cmd).isEqualTo('unsetCustomTags');
        assertThat(arg).isEqualTo(['key1', 'key2']);
      };
    });
    runCode(mockData);
    assertApi('gtmOnSuccess').wasCalled();
- name: trackError tag calls apptracker with message
  code: |-
    mockData.type = 'trackError';
    mockData.trackErrorMessage = 'Test error';
    mock('copyFromWindow', function(key) {
      return function(cmd, arg) {
        assertThat(cmd).isEqualTo('trackError');
        assertThat(arg.message).isEqualTo('Test error');
      };
    });
    runCode(mockData);
    assertApi('gtmOnSuccess').wasCalled();
- name: Non-init tag when apptracker missing fails
  code: |-
    mockData.type = 'trackPageView';
    mock('copyFromWindow', function(key) {
      return undefined;
    });
    runCode(mockData);
    assertApi('gtmOnFailure').wasCalled();


___NOTES___

Conviva AppAnalytics GTM Template. Created for Community Template Gallery.
